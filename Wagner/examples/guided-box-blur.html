<!doctype html>
<html lang="en">
	<head>
		<title>Wagner - Minefield!</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #ffffff;
				font-family: 'roboto condensed', tahoma;
				font-size:13px;
				text-align: left;
				font-weight: 100;
				background-color: #111;
				sbackground-image: url( escheresque_ste.png );
				margin: 0px;
				overflow: hidden;
			}
			#container canvas{ width: 100%; height: 100%;}
			#fullscreenBtn{ position: absolute; left: 10px; top: 60px; color :white; border: 1px solid white; border-radius: 4px; padding: 10px 20px; background-color: black; text-decoration: none;}
			#fullscreenBtn:hover{ color: black; background-color: white;}
			#about{ position: absolute; left: 10px; top: 10px; background-color: #000; padding: 10px;}
			a{ color: #b70000;}
		</style>
		<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
	</head>
	<body>

		<div id="container"></div>
		<a href="#" id="fullscreenBtn" >Go fullscreen</a>
		<div id="about" ><b>Wagner</b> Guided Box Blur Pass</div>

<script src="../js/three.min.js"></script>
<!--<script src="http://spite.github.io/rstats/rStats.js" ></script>
<script src="http://spite.github.io/rstats/rStats.extras.js" ></script>-->
<script src="../Wagner.js"></script>
<script src="../Wagner.base.js"></script>
<script src="../Wagner.experimental.js"></script>
<script src="../ShaderLoader.js"></script>
<script src="../js/debugTools.js"></script>

<script src="DAT.GUI.min.js"></script>
<script src="main.js"></script>

<script>

WAGNER.vertexShadersPath = '../vertex-shaders';
WAGNER.fragmentShadersPath = '../fragment-shaders';
WAGNER.assetsPath = '../assets/';

var blurPass;
var gui;
var glowTexture;

var depthMaterial = new THREE.MeshBasicMaterial();

function initPass() {

	createTeapot();

	composer = new WAGNER.Composer( renderer, { useRGBA: false } );
	blurPass = new WAGNER.GuidedBoxBlurPass();

	gui = new DAT.GUI();

	gui.add( blurPass.params, 'invertBiasMap' );
	gui.add( blurPass.params, 'from' ).min(0).max(1);
	gui.add( blurPass.params, 'to' ).min(0).max(1);
	gui.add( blurPass.params.delta, 'x' ).min(0).max(.1);
	gui.add( blurPass.params.delta, 'y' ).min(0).max(.1);
	gui.open();

	var sL = new ShaderLoader()
	sL.add( 'depth-vs', '../vertex-shaders/packed-depth-vs.glsl' );
	sL.add( 'depth-fs', '../fragment-shaders/packed-depth-fs.glsl' );
	sL.load();
	sL.onLoaded( function() {
		depthMaterial = new THREE.ShaderMaterial( {
			uniforms: {
				mNear: { type: 'f', value: camera.near },
				mFar: { type: 'f', value: camera.far }
			},
			vertexShader: this.get( 'depth-vs' ),
			fragmentShader: this.get( 'depth-fs' ),
			shading: THREE.SmoothShading
		} );
	} );

}

function resizePass() {

	composer.setSize( renderer.domElement.width, renderer.domElement.height );
	depthTexture = WAGNER.Pass.prototype.getOfflineTexture( composer.width, composer.height, false );

}

function renderPass() {
		
	composer.reset();

	scene.overrideMaterial = depthMaterial;
	composer.render( scene, camera, null, depthTexture );
	blurPass.params.tBias = depthTexture;

	scene.overrideMaterial = null;
	composer.render( scene, camera );

	composer.pass( blurPass );
	composer.toScreen();
	
}

</script>
		
	</body>
</html>
